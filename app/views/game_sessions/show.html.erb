<div class="height-div container-fluid align-items-center justify-content-center text-center">
  <div class="bg-light p-2 rounded container-fluid">
    <h4 class="mb-3">INVITE TES AMIS: </h4>
    <p class="text-center">envoie leur ce num√©ro de partie : <%= @round.id %></p>
    <p class="text-center pb-0 mb-0">OU envoi leur ce lien :</p>
    <input id="url" type="text" value="www.wikirace.xyz/rounds/<%= @round.id %>/round_participations/new" readonly></input>
    <button id="copy-button" class="mb-3">Copy</button>
    <p class="text-center mb-0">OU fais leur flasher ce QRcode</p>
  </div>
  <br>

  <%if current_user.id == @game_session.user_id  %>
    <div class="container">
      <div class="btn-blue text-center">
        <%= link_to "START THE GAME", round_path(@round), id: "start-game" %>
      </div>
    </div>
  <%end  %>
  <br>

  <!-- <img src=<%#= "http://api.qrserver.com/v1/create-qr-code/?data=http://www.wikirace.xyz/rounds/#{@round.id}/round_participations/new/&size=[150]x[150]" %> alt="Le QR Code pour rejoindre la partie" title="QR Code" /> -->
  <div class="text-align-center">
    <div class="container-fluid d-flex justify-content-around align-items-center">
      <p class="mb-0">Waiting for your friends...</p>
      <div class="spinner-box">
        <div class="leo-border-1">
          <div class="leo-core-1"></div>
        </div>
        <div class="leo-border-2">
          <div class="leo-core-2"></div>
        </div>
      </div>
    </div>
    <div class="text-align-center d-inline-block justify-content-center pb-0">
      <% @round.round_participations.each do |round_participation| %>
        <p class="mb-0 pb-0">> <%= User.find(round_participation.user_id).username %></p>
      <% end %>
      <p>...</p>
    </div>
  </div>
  <br>

    <!-- this part is the chat window -->
  <div class="container-fluid bg-light radius p-2">
    <div class="">
      <div class=""><h4>TAILLE TES POTES !</h4></div>
      <div class="messages">
        <% @game_session.messages.each do |message| %>
          <%= render "messages", message: message %>
        <% end %>
      </div>
      <div id="create-message" class="mt-4">
        <%= simple_form_for [@game_session, Message.new], remote: true do |f| %>
          <%= f.input :content, label: false %>
        <% end %>
      </div>
    </div>
  </div>

</div>

<!-- that is the subscription that happens when a user gets to the game_session#show -->
<% content_for :after_js do %>
  <script>
    App['game_session_channel_<%= @game_session.id %>'] = App.cable.subscriptions.create(
    { channel: 'GameSessionChannel', game_session_id: <%= @game_session.id %> },
    {received: (data) => {
      // here we have the content that will be broadcasted
      const messagesContainer = document.querySelector('.messages');
      messagesContainer.insertAdjacentHTML('beforeend', data.message_partial);
      const  input = document.querySelector('#message_content');
      input.value = '';
      input.blur();
    }
    })
  </script>
<% end %>

